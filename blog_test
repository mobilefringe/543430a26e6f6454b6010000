<style>
    .margin_30 {
        margin-bottom: 30px;
    }
    h5 {
        font-family: 'Eb Garamond', serif;
        font-size: 24px;
        color: #467384;
        text-transform:uppercase;
    }
    .main_post_image_container {
        width: 700px;
        height: 450px;
        position: relative;
    }
    .main_post_image_container img {
        width: 100%;
        height: 100%;
    }
    
    .main_post_content {
        padding: 33px 35px;
        width: 460px;
        height: 302px;
        position: absolute;
        top: 74px;
        right: 15px;
        background: rgba(250, 250, 250, .7);
        border: 1px solid #d3d3d3;
    }
    .post_content {
        padding: 50px 55px;
        position: relative;
    }
    .main_post_header, .post_header {
        font-family: 'Open Sans Condensed', sans-serif;
        font-weight: 700;
        font-size: 24px;
    }
    .main_post_header {
        text-transform: uppercase;
    }
    .post_container {
        width: 100%;
        height: 280px;
        border: 1px solid #d3d3d3;
    }
    .post_text {
        font-size: 22px;
        line-height: 30px;
        color: #5F574B;
    }
    .read_more {
        font-size: 20px;
    }
    .post_share_icons {
        position: absolute;
        top: 0;
        right: 0;
    }
    .post_icon {
        width: 36px;
    }
    .load_more {
        font-weight: lighter;
        font-size: 24px;
        color: #D8836C;
        display: inline-block;
    }
</style>
<div class="jobs_banner text-center">
    <h3>BLOG</h3>
    <p>explore • enjoy • shop</p>
</div>
<div class="store_list_head main_container">
    <div class="row hidden_phone">
        <div class="col-md-3">
            <h5><a href="/shop_the_look">STYLE FILE</a></h5>
        </div>
        <div class="col-md-3 text-center">
            <h5><a href="/shop_the_look">SHOP THE LOOK</a></h5>
        </div>
        <div class="col-md-3 text-center">
            <h5><a href="/attract">OPPOSITES ATTRACT</a></h5>
        </div>
        <div class="col-md-3">
            <h5 class="active_heading">BLOG</h5>
        </div>
    </div>
    <!--<h5 class="text-center tap_here show_phone">-->
    <!--    <select id="option_selector" class="link_selector">-->
    <!--        <option value="" disabled selected>TAP FOR MORE OPTIONS</option>-->
    <!--        <option value="/style_file">Style File</option>-->
    <!--        <option value="/shop_the_look">Shop The Look</option>-->
    <!--        <option value="/attract">Opposites Attract</option>-->
    <!--    </select>-->
    <!--</h5>-->
</div>
<div class="margin_20"></div>
<div class="content_container main_container mobile_padding">
    <div class="margin_25_across">
        <div class="row">
            <div class="col-md-12" id="main_post_container">
                <script id="main_post_template" type="x-tmpl-mustache">
                    <div class="">
                        <div class="main_post_image_container">
                            <img src="{{post_image}}" alt="{{title}}">
                        </div>
                        <div class="main_post_content">
                            <h2 class="main_post_header">{{title}}</h2>
                            <div class="post_text">
                                {{description_short}}
                                <a class="read_more" href="">Read More</a>
                            </div>
                        </div>
                    </div>
                </script>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <h5>Previous</h5>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12" id="post_container">
                <script id="post_template" type="x-tmpl-mustache">
                    <div class="row_fluid">
                        <div class="post_container">
                            <div class="col-md-6">
                                <div class="post_image_container">
                                    <img src="{{post_image}}" alt="{{title}}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="post_content">
                                    <div class="post_share_icons">
                                        <img class="post_icon" src="http://assets.codecloudapp.com/sites/5808c7e76e6f6414b30c0000/image/png/1490295919000/Facebook Button Small.png" class="" alt="">
                                        <img class="post_icon" src="http://assets.codecloudapp.com/sites/5808c7e76e6f6414b30c0000/image/png/1490295931000/Twitter Button Small.png" class="" alt="">
                                    </div>
                                    <h2 class="post_header">{{title}}</h2>
                                    <div class="post_text">{{description_short}}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="margin_30"></div>
                </script>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <a class="load_more" href="javascript:void(0);" onclick="renderPosts('#post_container', '#post_template', posts);">
                    Load More
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function(e){
        init(e);
        loadMallDataCached(renderPageData);
    });
    
    function renderPageData(){
        var blog = getBlogDataBySlug('halifaxcentre-test-blog');
        var blog_posts = blog.posts.reverse();
            console.log(blog_posts);
        
        var main_post = blog_posts[0];
        renderSinglePost('#main_post_container', "#main_post_template", main_post);

        var posts = blog_posts.splice(1);
        console.log(posts);
        renderPosts('#post_container', '#post_template', posts);
        show_content();
    }
    var interval = 3;
    var totalPosts;
    var showingPosts;

    function renderPosts(container, template, posts){
        var item_list = [];
        var item_rendered = [];
        var template_html = $(template).html();
        var counter = 1;
        Mustache.parse(template_html);   // optional, speeds up future uses
        
        var interval = 3;
        var totalPosts;
        var showingPosts;
        totalPosts = posts.length;
        console.log(total_posts);
        showingPosts = $('.post_container').length + interval;
    
        $.each( collection , function( key, val ) {
            if (val.image_url.indexOf('missing.png') > -1) {
                val.post_image = "//codecloud.cdn.speedyrails.net/sites/57f7f01f6e6f647835890000/image/png/1461352407000/HallifaxLogo.png";
            } else {
                val.post_image = val.image_url;
            }
            if(val.body.length > 100){
                val.description_short = val.body.substring(0,100) + "...";
            }
            else{
                val.description_short = val.body;
            }
            val.description_short = val.description_short.replace("&amp;", "&");
            var date_blog = new Date(val.publish_date);
            val.published_on = get_month(date_blog.getMonth()) + " " + date_blog.getDate() + ", " + date_blog.getFullYear();
            
            var rendered = Mustache.render(template_html,val);
            item_rendered.push(rendered);
            counter = counter+1;
        });
        $(container).show();
        $(container).html(item_rendered.join(''));
    }
    
    function renderSinglePost(container, template, main_post){
        var item_list = [];
        var template_html = $(template).html();
        Mustache.parse(template_html);   // optional, speeds up future uses

        if (main_post.image_url.indexOf('missing.png') > 0) {
            main_post.post_image = "//codecloud.cdn.speedyrails.net/sites/57f7f01f6e6f647835890000/image/png/1461352407000/HallifaxLogo.png";
        } else {
            main_post.post_image = main_post.image_url;
        }
            
        if(main_post.body.length > 50){
            main_post.description_short = main_post.body.substring(0,50) + "...";
        }
        else{
            main_post.description_short = main_post.body;
        }
        main_post.description_short = main_post.description_short.replace("&amp;", "&");
            
        var rendered = Mustache.render(template_html, main_post);
        item_list.push(rendered);
        $(container).html(item_list.join(''));
    }
</script>