
<div class="flexslider text-center">
    <ul class="slides" id="time_banner">
        <script id="banner_template" type="x-tmpl-mustache/text">
            <li class="position_relative">
                <div class="hero_banner special_event_banner" style="background-image: url({{image_url}})">
                    // <h2 class="banner_header">{{name}}</h2>
                    <h2 class="banner_header">Holiday Campaign</h2>
                    <p>{{description}}</p>
                    <a style="display:none" href="#box_3_page_image" class="time_btn animated_btn">Buy tickets</a>
                </div>
            </li>    
        </script>
    </ul>
</div>


<!--FIRST BOX-->
<div class="content_container main_container container_bottom_border">
    <div class="details_flex_container">
        <div class="details_img_container">
            <img id="box_1_image" src="" alt="">
        </div>
        <div class="details_info_container">
            <div class="details_title" id="box_1_title"></div>
            <div class="details_info" id="box_1_desc"></div>
        </div>
    </div>
</div>


<!--SECOND BOX -->
<div class="content_container main_container container_bottom_border">
    <div class="details_flex_container left_column_reverse">
        <div class="left_details_info_container">
            <div class="details_title" id="box_2_title"></div>
            <div class="details_info" id="box_2_desc"></div>
        </div>
        <div class="left_details_img_container">
            <img id="box_2_image" src="" alt="">
        </div>
    </div>
</div>

<!--THIRD BOX -->
<div class="content_container main_container container_bottom_border">
    <div class="details_flex_container">
        <div class="details_img_container">
            <img id="box_3_page_image" src="" alt="">
        </div>
        <div class="details_info_container">
            <div class="details_title" id="box_3_page_title"></div>
            <div class="details_info" id="box_3_page_desc"></div>
        </div>
    </div>
</div>


<!--HOLIDAY HOURS -->
<div class="content_container main_container hours_section">
    <div class="workshops_spacing">
        <h2 class="details_title workshop_title text-center">Holiday Hours</h2>
        
        <div class="row" id="holidays_hours_container">
            <script id="holidays_hours_template" type="x-tmpl-mustache/text">
                <div class="col-md-6 hours_div">
                    <div class="content">
                        <span>{{holiday_name}} ({{formatted_date}})</span>
                    </div>
                </div>
                <div class="col-md-6 hours_div">
                    <div class="content">
                        <span>{{h}}</span>
                    </div>
                </div>
            </script>
        </div>
    </div>
</div>

             


<div class="content_container main_container">
    <div class="workshops_spacing">
        <h2 class="details_title workshop_title text-center">Promos</h2>
        <div id="promos_container">
            <script id="promos_template" type="x-tmpl-mustache/text">
                <div class="promo_item cats_row" data-cat="{{cat_list}}">
                    <div class="col-md-3">
                        <div class="cropped_image">
                            <img src="{{image_url}}" alt="{{name}}" />
                        </div>

                        <h2 class="promo_list_name"><a href="/promotions/{{slug}}">{{name}}</a></h2>
                        <p>
                            <a href="{{store_slug}}" style="{{store_show}}"><span class="underline promo_store">{{store_name}}</span></a>
                            <span class="promo_dates">{{dates}}</span>
                        </p>
                
                        <a class="read_more" href="/promotions/{{slug}}">Read More</a>
                    </div>
                </div>
            </script>
        </div>
    </div>
</div>


<div class="content_container main_container">
    <div class="workshops_spacing application-info">
        <h2 class="details_title workshop_title text-center">Application Info</h2>
        <div class="row" id="sponsors_container">
            <script id="sponsors_template" type="x-tmpl-mustache/text">
                <div class="col-md-4 col-sm-6">
                    {{#url}}
                    <a href="{{url}}" target="_blank">
                    {{/url}}
                        <img class="sponsor_img" alt="{{name}}" src="{{image_url}}" />
                    </a>
                </div>
            </script>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.min.js"></script>
<script>
    $(document).ready(function(e){
        init(e);
        function renderAll(){
            var pageBanner = null;
            var banners = getRepoDetailsByName("Holiday Campaign Banner");
            if (banners) {
                try {
                    pageBanner = banners.images[0];
                } catch (e) {
                    pageBanner = { "image_url": "" }
                }
            } else {
                pageBanner = { "image_url": "" }
            }
            
            renderGeneral('#time_banner','#banner_template',pageBanner);

            var pathArray = window.location.pathname.split( '/' );
            var slug = pathArray[pathArray.length-1];
            prefix = get_prefix();
            

        
            var pages_json = prefix + "/pages/halifaxcentre-holiday-campaign-intro-1.json"
            $.getJSON(pages_json).done(function(data) {
                $('#box_1_title').html(data.title.toUpperCase());
                $('#box_1_desc').html(data.body);
                $('#box_1_image').attr('src', data.image_url);
                $('#box_1_image').attr('alt', data.title);
                
            }).fail(function(jqXHR) {
                if (jqXHR.status == 404) {
                    $("#404_msg").fadeIn("fast");
                }
            });
            
            
            var pages_json = prefix + "	/pages/halifaxcentre-holiday-campaign-intro-2.json"
            $.getJSON(pages_json).done(function(data) {
                const image = data.image_url;
                $('#box_2_title').html(data.title.toUpperCase());
                $('#box_2_desc').html(data.body);
                $('#box_2_image').attr('src', data.image_url);
                $('#box_2_image').attr('alt', data.title);
    
            }).fail(function(jqXHR) {
                if (jqXHR.status == 404) {
                    $("#404_msg").fadeIn("fast");
                }
            });
            
            // const workshopImages = getRepoDetailsByName("Workshop Images").images;
            // const sortedWorkshopImages = _.sortBy(workshopImages, [function(o) { return o.updated_at; }]);
            // renderGeneral('#workshops_container','#workshop_template', sortedWorkshopImages);
            
             var pages_json = prefix + "/pages/halifaxcentre-holiday-campaign-intro-3.json"
            $.getJSON(pages_json).done(function(data) {
                const image = data.image_url;
                $('#box_3_page_title').html(data.title.toUpperCase());
                $('#box_3_page_desc').html(data.body);
                $('#box_3_page_image').attr('src', data.image_url);
                $('#box_3_page_image').attr('alt', data.title);
    
            }).fail(function(jqXHR) {
                if (jqXHR.status == 404) {
                    $("#404_msg").fadeIn("fast");
                }
            });
            
            
            var holiday_hours = getPropertyHolidayHours().sortBy(function(o){ return o.holiday_date });;
            renderHours('#holidays_hours_container','#holidays_hours_template', holiday_hours, 'holiday_hours')
            
            var promotions = getPromotionsList().sortBy(function(o){ return o.end_date });
            
            var categories = getStoreCategories();
            renderGeneral('#category_container', '#category_template', categories);
            renderGeneral('#mobile_cat_list', '#category_template2', categories);
            $('#mobile_cat_list').prepend('<option value="all" selected >All Categories</option>');
            show_cat_stores()
            var published_promos = [];
            $.each( promotions , function( key, val ){
                today = moment();
                webDate = moment(val.show_on_web_date);
                if (today >= webDate) {
                    published_promos.push(val)
                } 
            });
            if(published_promos.length > 0){
                var feature_promos = _.sortBy(_.filter(published_promos, function(o){return o.is_featured;}), [function(a) { return a.feature_item_index; }]);
                var reg_promos = _.filter(published_promos, function(o){return !o.is_featured;});
                var all_promos = _.concat(feature_promos, reg_promos);
                console.log(all_promos);
                renderPromotions("#promos_container","#promos_template", all_promos, "Halifax");
            }
            else{
                $('#no_promos').show()
            }
            
            show_content();
            
             $('#contact_form').submit(function(e) {
                e.preventDefault();
                 $.ajax({
                    url : "//mallmaverick.com/send_contact_email",
                    type: "POST",
                    data : { 
                        'send_to': "Charlotte.Hanington@cushwake.com", 
                        'subject': "Bridge Through Time", 
                        'body': {
                            "Name": $('#full_name').val(), 
                            "Email Adddress": $('#email').val(), 
                            "Message": $('#message').val()
                        } 
                    },
                    success: function(data, textStatus, jqXHR) {
                        $('#send_contact_success').fadeIn();
                        $('#contact_form').find("input[type=text], textarea").val("");
                        
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('#send_contact_error').fadeIn();
                    }
                }); 
    		});
    		
    		$('.flexslider').flexslider({
                animation: "slide",
            });
        }
        
        
        loadMallDataCached(renderAll); 
    });
</script>