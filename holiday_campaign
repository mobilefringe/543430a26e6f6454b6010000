
<div class="flexslider text-center">
    <ul class="slides" id="time_banner">
        <script id="banner_template" type="x-tmpl-mustache/text">
            <li class="position_relative">
                <div class="hero_banner holiday_campaign_banner" style="background-image: url({{image_url}})">
                </div>
            </li>    
        </script>
    </ul>
</div>


<!--FIRST BOX-->

<div class="content_container main_container container_bottom_border hol_box margin_25_across">
    <div class="details_flex_container">
        <div class="details_img_container">
            <img id="box_1_image" src="" alt="">
        </div>
        <div class="details_info_container">
            <div class="details_title" id="box_1_title"></div>
            <div class="details_info" id="box_1_desc"></div>
        </div>
    </div>
</div>


<!--SECOND BOX -->
<div class="content_container main_container container_bottom_border hol_box margin_25_across">
    <div class="details_flex_container left_column_reverse">
        <div class="left_details_info_container">
            <div class="details_title" id="box_2_title"></div>
            <div class="details_info" id="box_2_desc"></div>
        </div>
        <div class="left_details_img_container">
            <img id="box_2_image" src="" alt="">
        </div>
    </div>
</div>

<!--THIRD BOX -->
<div class="content_container main_container container_bottom_border hol_box margin_25_across">
    <div class="details_flex_container">
        <div class="details_img_container">
            <img id="box_3_page_image" src="" alt="">
        </div>
        <div class="details_info_container">
            <div class="details_title" id="box_3_page_title"></div>
            <div class="details_info" id="box_3_page_desc"></div>
        </div>
    </div>
</div>


<!--HOLIDAY HOURS-->
<div class="content_container main_container hours_section margin_25_across">
    <div class="hol_campaign_spacing">
        <h2 class="details_title workshop_title">Holiday Hours</h2>
        
        <div class="row extended_hours_container" id="holidays_hours_container">
            <script id="holidays_hours_template" type="x-tmpl-mustache/text">
                <div class="holiday_dates">
                    
                    <span>{{formatted_date}}</span>
                    
                </div>
                <div class="holiday_hrs ">
                    <span>{{h}}</span>
                </div>
            </script>
        </div>
    </div>
</div>


<!--HOLIDAY EVENTS -->
<div class="content_container main_container margin_25_across">
    <div class="hol_campaign_spacing">
        <h2 class="details_title workshop_title">Holiday Events</h2>
        <div id="promos_container" class="row">
            <script id="promos_template" type="x-tmpl-mustache/text">
                <div class="col-md-4">
                    <div class="promo_item cats_row"  data-cat="{{cat_list}}">
                        <div class="cropped_image">
                            <img src="{{image_url}}" alt="{{name}}" />
                        </div>
                        <h2 class="promo_list_name text-center"><a href="/promotions/{{slug}}">{{short_name}}</a></h2>
                        <p class="text-center">
                            <a href="{{store_slug}}" style="{{store_show}}"><span class="underline promo_store">{{store_name}}</span></a>
                            <span class="promo_dates">{{dates}}</span>
                        </p>
                        <p class="text-center"><a class="read_more" href="/events/{{slug}}">See Event Details</a></p>
                        
                    </div>
                </div>
            </script>
        </div>
    </div>
</div>
<!--FOURTH BOX -->
<div class="application-info margin_30">
    <div class="content_container main_container margin_25_across">
        <div class="hol_campaign_spacing">
            <h2 class="details_title" id="box_4_title"></h2>
            <div id="box_4_desc">
                <script id="sponsors_template" type="x-tmpl-mustache/text">
                    <div class="col-md-12">
                        <p id="box_4_desc"></p>
                        
                    </div>
                </script>
            </div>
        </div>
    </div>
</div>




<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.min.js"></script>
<script>
    $(document).ready(function(e){
        init(e);
        function renderAll(){
            var pageBanner = [];
            var banners = getRepoDetailsByName("Holiday Campaign Banner");
            if (banners && banners.images.length > 0) {
                try {
                    
                    pageBanner = banners.images
                } catch (e) {
                    pageBanner = [{ "image_url": "" }]
                }
            } else {
                pageBanner = [{ "image_url": "" }]
            }
            console.log(pageBanner)
            
            renderGeneral('#time_banner','#banner_template',pageBanner);

            var pathArray = window.location.pathname.split( '/' );
            var slug = pathArray[pathArray.length-1];
            prefix = get_prefix();
            

        
            var pages_json = prefix + "/pages/halifaxcentre-holiday-campaign-intro-1.json"
            $.getJSON(pages_json).done(function(data) {
                $('#box_1_title').html(data.title.toUpperCase());
                $('#box_1_desc').html(data.body);
                $('#box_1_image').attr('src', data.image_url);
                $('#box_1_image').attr('alt', data.title);
                
            }).fail(function(jqXHR) {
                if (jqXHR.status == 404) {
                    $("#404_msg").fadeIn("fast");
                }
            });
            
            
            var pages_json = prefix + "	/pages/halifaxcentre-holiday-campaign-intro-2.json"
            $.getJSON(pages_json).done(function(data) {
                const image = data.image_url;
                $('#box_2_title').html(data.title.toUpperCase());
                $('#box_2_desc').html(data.body);
                $('#box_2_image').attr('src', data.image_url);
                $('#box_2_image').attr('alt', data.title);
    
            }).fail(function(jqXHR) {
                if (jqXHR.status == 404) {
                    $("#404_msg").fadeIn("fast");
                }
            });
            
             var pages_json = prefix + "/pages/halifaxcentre-holiday-campaign-intro-3.json"
            $.getJSON(pages_json).done(function(data) {
                const image = data.image_url;
                $('#box_3_page_title').html(data.title.toUpperCase());
                $('#box_3_page_desc').html(data.body);
                $('#box_3_page_image').attr('src', data.image_url);
                $('#box_3_page_image').attr('alt', data.title);
    
            }).fail(function(jqXHR) {
                if (jqXHR.status == 404) {
                    $("#404_msg").fadeIn("fast");
                }
            });
            
            
            var holiday_hours = getPropertyExtendedHours().sortBy(function(o){ return o.holiday_date });
            renderHours('#holidays_hours_container','#holidays_hours_template', holiday_hours, 'extended_hours')
            
            var events = getEventsList().sortBy(function(o){ return o.end_date });
            console.log(events)
            var published_events = [];
            $.each( events , function( key, val ){
                if(val.tags.includes('Holiday')){
                    today = moment();
                    webDate = moment(val.show_on_web_date);
                    if (today >= webDate) {
                        if (val.name.length > 30) {
                            val.short_name = _.truncate(val.name, { 'length': 30, 'separator': ' ' });
                        } else {
                            val.short_name = val.name
                        }
                        published_events.push(val)
                        
                    } 
                }
            });
            if(published_events.length > 0){
                var feature_events = _.sortBy(_.filter(published_events, function(o){return o.is_featured;}), [function(a) { return a.feature_item_index; }]);
                var reg_events = _.filter(published_events, function(o){return !o.is_featured;});
                var all_events = _.concat(feature_events, reg_events);
            
                
                renderEvents("#promos_container","#promos_template", all_events, "Halifax Shopping Centre");
            } else {
                $('#no_events').show()
            }
            
            
            var pages_json = prefix + "/pages/halifaxcentre-holiday-campaign.json"
            $.getJSON(pages_json).done(function(data) {
                const image = data.image_url;
                $('#box_4_title').html(data.title.toUpperCase());
                $('#box_4_desc').html(data.body);
    
            }).fail(function(jqXHR) {
                if (jqXHR.status == 404) {
                    $("#404_msg").fadeIn("fast");
                }
            });
            
            show_content();
            
            
    		
    		$('.flexslider').flexslider({
                animation: "slide",
            });
        }
        
        
        loadMallDataCached(renderAll); 
    });
</script>